---
layout: post
title:  "指数加权平均（Exponentially Weight Average）-吴恩达 深度学习 course2 2.3~2.5笔记"
date:   2018-04-28 20:53:15
categories: DeepLearning
tags: DeepLearning 吴恩达
mathjax: true
---

* content
{:toc}

指数加权平均（Exponentially Weight Average）是一种常用的序列数据处理方式
<!--more-->

## 计算公式
- 指数加权平均（Exponentially Weight Average）是一种常用的序列数据处理方式，计算公式为：

$$
S_t =
\begin{cases}
Y_1, &t = 1 \\
\beta S_{t-1} + (1-\beta)Y_t, &t > 1
\end{cases}
$$

其中 Yt 为 t 下的实际值，St 为 t 下加权平均后的值，β 为权重值。

![Exponentially weighted averages](http://p5ocy6pck.bkt.clouddn.com/Exponentially-weight-average.png)

给定一个时间序列，例如伦敦一年每天的气温值，图中蓝色的点代表真实数据。对于一个即时的气温值，取权重值 β 为 0.9，根据求得的值可以得到图中的红色曲线，它反映了气温变化的大致趋势。

当取权重值 β=0.98 时，可以得到图中更为平滑的绿色曲线。而当取权重值 β=0.5 时，得到图中噪点更多的黄色曲线 **。β 越大相当于求取平均利用的天数越多，曲线自然就会越平滑而且越滞后。**

## 理解指数加权平均

当 β 为 0.9 时，


$$
v_{100} = 0.9v_{99} + 0.1 \theta_{100}
$$

$$
v_{99} = 0.9v_{98} + 0.1 \theta_{99}
$$

$$
v_{98} = 0.9v_{97} + 0.1 \theta_{98}
$$

...

$$
v_{100} = 0.1 \theta_{100} + 0.1 * 0.9 \theta_{99} + 0.1 * {(0.9)}^2 \theta_{98} + ...
$$

其中 θi 指第 i 天的实际数据。所有 θ 前面的系数（不包括 0.1）相加起来为 1 或者接近于 1，这些系数被称作**偏差修正（Bias Correction）**。

根据函数极限的定理：

$$
{\lim_{\beta\to 0}}(1 - \beta)^{\frac{1}{\beta}} = \frac{1}{e} \approx 0.368
$$


当 β 为 0.9 时，可以当作把过去 10 天的气温指数加权平均作为当日的气温，因为 10 天后权重已经下降到了当天的 1/3 左右。同理，当 β 为 0.98 时，可以把过去 50 天的气温指数加权平均作为当日的气温。

因此，在计算当前时刻的平均值时，只需要前一天的平均值和当前时刻的值。


$$
v_t = \beta v_{t-1} + (1 - \beta)\theta_t
$$

考虑到代码，只需要不断更新 v 即可：


$$
v := \beta v + (1 - \beta)\theta_t
$$

指数平均加权并不是最精准的计算平均数的方法，你可以直接计算过去 10 天或 50 天的平均值来得到更好的估计，但**缺点**是保存数据需要占用更多内存，执行更加复杂，计算成本更加高昂。

指数加权平均数公式的好处之一在于它只需要一行代码，且占用极少内存，因此 **效率极高，且节省成本。**
## 指数加权平均的偏差修正
我们通常有


$$
v_0 = 0
$$

$$
v_1 = 0.98v_0 + 0.02\theta_1
$$

因此，v1 仅为第一个数据的 0.02（或者说 1-β），显然不准确。往后递推同理。

因此，我们修改公式为

$$
v_t = \frac{\beta v_{t-1} + (1 - \beta)\theta_t}{1-\beta^t}
$$

随着 t 的增大，β 的 t 次方趋近于 0。因此当 t 很大的时候，偏差修正几乎没有作用，但是在前期学习可以帮助更好的预测数据。在实际过程中，一般会忽略前期偏差的影响。
